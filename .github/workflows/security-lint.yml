name: security-lint

on:
  pull_request:
  push:
    branches:
      - main
      - master
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  workflow-guard:
    runs-on: ubuntu-22.04
    if: false  # superseded by hub-pipeline workflow-guard
    steps:
      - name: Checkout
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4

      - name: Verify workflow pins + secretless envs
        run: python scripts/check_workflow_integrity.py

      - name: Validate runner isolation budgets
        run: python scripts/check_runner_isolation.py --config config/runner-isolation.yaml

      - name: Secret keyword sweep
        run: |
          set -euo pipefail
          if grep -R -n -E 'AWS_SECRET|_KEY=|TOKEN=' \
            --exclude='security-lint.yml' \
            --exclude='security-lint.yaml' \
            .github/workflows; then
            echo "::error::Potential static secret detected in workflow definition"
            exit 1
          else
            echo "No static secrets detected in workflow definitions"
          fi

  dependency-review:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-22.04
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Dependency review
        uses: actions/dependency-review-action@5194ced0a6f398b5acd35d8917d81e4f5d5f04cf # v4
